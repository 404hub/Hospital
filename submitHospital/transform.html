<html>
<head>
    <link href="./bootstrap-combined.min.css" rel="stylesheet">
</head>

<body>
<div class="container">
    <h3>Copy属于同一个省的多个城市的数据过来转换</h3>
    <form method="post" class="form-horizontal">
        <fieldset>
            <div class="control-group">
                <label class="control-label" for="province">省份</label>

                <div class="controls">
                    <input class="input-xlarge" type="text" name="province" id="province" value="">
                </div>

                <div class="controls">
            <textarea class="input-xlarge" name="json" id="json" placeholder="原来的json数据"
                      style="margin: 0px; height: 500px; width: 600px;"></textarea>
                </div>
            </div>

            <div class="form-actions">
                <input type="button" name="yaml" id="yaml" value="generate YAML" class="btn btn-primary">
            </div>
            <div class="controls">
            <textarea class="input-xlarge" name="yaml_dump" id="yaml_dump"
                      style="margin: 0px; height: 500px; width: 600px;"></textarea>
            </div>
        </fieldset>
    </form>
</div>

<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script src="bower_components/js-yaml/dist/js-yaml.min.js"></script>
<script src="bower_components/uuid4/lib/browser/index.js"></script>
<script>
    var dataversion = 'draft1';

    function newId() {
        return UUID4.generate();
    }

    function generateHospital(city, hospital) {
        var result = {};
        result.dataversion = dataversion;
        result.created = Math.floor(Date.now() / 1000);
        result.id = newId();
        result.USID = '';
        result.name = hospital;
        result.city = city;
        result.province = $("#province").val();
        result.address = '';
        result.type = '';
        result.location = '';
        result.principal = '';
        result.shareholder = [];
        result.url = [];
        result.phone = [];
        result.baiduad = {};
        result.news = {};
        result.putian = {};
        result.comments = {};
        result.note = '';
        return result;
    }

    function generateOneCity(city, hospitals) {
        var result = [];
        for (var hospital in hospitals) {
            result.push(generateHospital(city, hospital));
        }
        return result;
    }

    function generateMultipleCities() {
        var result = {};
        var input = JSON.parse($('#json').val());
        console.log('ok');
        for (var city in input) {
            console.log(city);
            result[city] = (generateOneCity(city, input[city]));
        }
        return result;
    }

    $(document).ready(function () {
        $('#yaml').click(function () {
            event.preventDefault();
            var result = generateMultipleCities();
            var yaml = jsyaml.safeDump(result);
            console.log(yaml);
            $("#yaml_dump").val(yaml);
        });
    });
</script>
</body>
</html>